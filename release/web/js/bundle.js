!function(){"use strict";class t extends fgui.GComponent{constructor(){super(),this._isAuto=!1}constructFromXML(t){super.constructFromXML(t),this._title=this.getChild("title").asTextField,this._bg=this.getChild("bg").asGraph}set bgColor(t){this._bg.color=t}set title(t){this._text=t,this._title.text=t}get title(){return this._text}set isAuto(t){this._isAuto=t}get isAuto(){return this._isAuto}}class e{}e.CHOOSE_NUMBER="choose_number";class s extends fgui.GComponent{constructor(){super(),this._types=["1","2","3","4","5","6","7","8","9"]}constructFromXML(t){super.constructFromXML(t),this.renderList()}show(){this.visible=!0}hide(){this.visible=!1}renderList(){var t=this.getChild("panel").asList;t.removeChildrenToPool(),t.on(fairygui.Events.CLICK_ITEM,this,this.onClickItem);for(let e=0;e<this._types.length;e++){const s=t.addItemFromPool(),i=this._types[e];s.title=i}}onClickItem(t){console.log(t.title),Laya.stage.event(e.CHOOSE_NUMBER,t.title),this.hide()}}class i{constructor(){}static init(){Laya.ClassUtils.regClass;fgui.UIObjectFactory.setExtension("ui://sudoku/grid",t),fgui.UIObjectFactory.setExtension("ui://sudoku/popup",s)}}i.width=750,i.height=1334,i.scaleMode="fixedauto",i.screenMode="none",i.alignV="top",i.alignH="left",i.startScene="",i.sceneRoot="",i.debug=!1,i.stat=!1,i.physicsDebug=!1,i.exportSceneToJson=!0,i.init();class o{static makeRow(t=0){const e=new Array(9);return e.fill(t),e}static makeMatrix(t=0){return Array.from({length:9},()=>this.makeRow(t))}static shuffle(t){const e=t.length-2;for(let s=0,i=t.length;s<e;s++){const e=Math.floor(Math.random()*(i-s));[t[s],t[e]]=[t[e],t[s]]}return t}static checkFillable(t,e,s,i){const r=t[s],a=o.makeRow().map((e,s)=>t[s][i]),{boxIndex:n}=o.convertToBoxIndex(s,i),l=o.getBoxCells(t,n);for(let t=0;t<9;t++)if(r[t]===e||a[t]===e||l[t]===e)return!1;return!0}static convertToBoxIndex(t,e){return{boxIndex:3*Math.floor(t/3)+Math.floor(e/3),cellIndex:t%3*3+e%3}}static convertFromBoxIndex(t,e){return{rowIndex:3*Math.floor(t/3)+Math.floor(e/3),colIndex:t%3*3+e%3}}static getBoxCells(t,e){const s=3*Math.floor(e/3),i=e%3*3,o=[];for(let e=0;e<9;e++){const r=s+Math.floor(e/3),a=i+e%3;o.push(t[r][a])}return o}}class r{constructor(){this.martrix=[],this._orders=[]}generate(){for(;!this.internalGenerate();)console.log("generate again!")}internalGenerate(){this.martrix=o.makeMatrix(),this._orders=o.makeMatrix().map(t=>t.map((t,e)=>e)).map(t=>o.shuffle(t));for(let t=1;t<=9;t++)if(!this.fillNumber(t))return!1;return!0}fillNumber(t){return this.fillRow(t,0)}fillRow(t,e){if(e>8)return!0;const s=this.martrix[e],i=this._orders[e];for(let r=0;r<9;r++){const a=i[r];if(!s[a]&&o.checkFillable(this.martrix,t,e,a)){if(s[a]=t,this.fillRow(t,e+1))return!0;s[a]=0}}return!1}}class a{constructor(){this._solutionMatrix=[],this.puzzlexMatrix=[];const t=new r;t.generate(),this._solutionMatrix=t.martrix}make(t=5){this.puzzlexMatrix=this._solutionMatrix.map(e=>e.map(e=>9*Math.random()<t?0:e))}}class n{constructor(t){this._isSuccess=!1,this._matrix=[],this._matrixMarks=[],this._matrix=t,this._matrixMarks=o.makeMatrix(!0)}get martixMarks(){return this._matrixMarks}get isSuccess(){return this._isSuccess}check(){return this.checkRows(),this.checkCols(),this.checkBoxes(),this._isSuccess=this._matrixMarks.every(t=>t.every(t=>t)),this._isSuccess}checkRows(){for(let t=0;t<9;t++){const e=this._matrix[t],s=n.checkArray(e);for(let e=0;e<s.length;e++)s[e]||(this._matrixMarks[t][e]=!1)}}checkCols(){for(let t=0;t<9;t++){const e=[];for(let s=0;s<9;s++)e[s]=this._matrix[s][t];const s=n.checkArray(e);for(let e=0;e<s.length;e++)s[e]||(this._matrixMarks[e][t]=!1)}}checkBoxes(){for(let t=0;t<9;t++){const e=o.getBoxCells(this._matrix,t),s=n.checkArray(e);for(let e=0;e<9;e++)if(!s[e]){const{rowIndex:s,colIndex:i}=o.convertFromBoxIndex(t,e);this._matrixMarks[s][i]=!1}}}static checkArray(t){const e=t.length,s=new Array(e).fill(!0);return t.forEach((e,i)=>{if(e){if(s[i])for(let o=i+1;o<9;o++)e===t[o]&&(s[i]=s[o]=!1)}else s[i]=!1}),s}}class l{constructor(){fgui.UIPackage.loadPackage("res/ui/sudoku",Laya.Handler.create(this,this.onUILoaded)),Laya.stage.on(e.CHOOSE_NUMBER,this,this.onChooseNumber)}onUILoaded(){this._view=fgui.UIPackage.createObject("sudoku","Main").asCom,this._view.x=(Laya.Browser.clientWidth-this._view.width/window.devicePixelRatio)/2,fgui.GRoot.inst.addChild(this._view),this._popup=this._view.getChild("n8"),this._list=this._view.getChild("n9").asList,this._list.on(fairygui.Events.CLICK_ITEM,this,this.onClickItem),this.renderList(),this._view.getChild("n3").onClick(this,this.check),this._view.getChild("n4").onClick(this,this.reset),this._view.getChild("n5").onClick(this,this.renderList)}renderListItem(){}renderList(){this._popup.hide(),this._list.removeChildrenToPool();const t=new a;t.make(5);const e=t.puzzlexMatrix;for(let t=0;t<e.length;t++)for(let s=0;s<9;s++){const i=this._list.addItemFromPool(),o=e[t][s];i.title="",i.bgColor="#ffffff",o&&(i.isAuto=!0,i.title=""+o,i.bgColor="#eeeeee")}}onClickItem(t){t.isAuto||(this._chooseGrid=t,this._popup.show())}onChooseNumber(t){this._chooseGrid.title=t}check(){this._popup.hide();let t=o.makeMatrix(),e=0;for(let s=0;s<81;s++){const i=+this._list.getChildAt(s).title||0;t[e][s%9]=i,(s+1)%9==0&&e++}const s=new n(t);s.check()&&alert("恭喜你全部都作对啦！");const i=s.martixMarks;for(let t=0;t<9;t++)for(let e=0;e<9;e++){const s=this._list.getChildAt(9*t+e);i[t][e]?s.bgColor="#ffffff":s.isAuto||(s.bgColor="#FEB6C3")}}reset(){this._popup.hide();for(let t=0;t<81;t++){const e=this._list.getChildAt(t);e.isAuto||(e.bgColor="#ffffff",e.title="")}}}new class{constructor(){window.Laya3D?Laya3D.init(i.width,i.height):Laya.init(i.width,i.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=i.scaleMode,Laya.stage.screenMode=i.screenMode,Laya.stage.alignV=i.alignV,Laya.stage.alignH=i.alignH,Laya.URL.exportSceneToJson=i.exportSceneToJson,(i.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),i.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),i.stat&&Laya.Stat.show(),Laya.alertGlobalError=!0,Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}onVersionLoaded(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}onConfigLoaded(){i.startScene&&Laya.Scene.open(i.startScene),Laya.stage.addChild(fgui.GRoot.inst.displayObject),Laya.stage.bgColor="#000000",new l}}}();